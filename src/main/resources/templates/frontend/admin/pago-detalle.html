<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Detalle de Pago - Technova</title>
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" th:href="@{/frontend/css/estilodas.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/stilotech.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/color-palette.css}">
    <style>
        .detalle-pago-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
            max-width: 1000px;
            margin: 0 auto;
        }

        .detalle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .detalle-header h2 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .btn-volver {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-volver:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .detalle-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .detalle-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .detalle-card h3 i {
            color: #667eea;
            font-size: 1.4rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: 600;
        }

        .info-value.amount {
            color: #00cc44;
            font-size: 1.4em;
            font-weight: 700;
        }

        .productos-section {
            margin-top: 20px;
        }

        .productos-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .productos-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .productos-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .productos-table th,
        .productos-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .productos-table th {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .productos-table tbody tr {
            transition: background 0.2s ease;
        }

        .productos-table tbody tr:hover {
            background: #f8f9fa;
        }

        .productos-table tbody tr:last-child td {
            border-bottom: none;
        }

        .productos-table td {
            color: #2c3e50;
        }

        .total-section {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            border: 2px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-label {
            font-size: 1.4em;
            font-weight: 700;
            color: #2c3e50;
        }

        .total-amount {
            font-size: 2em;
            font-weight: 700;
            color: #00cc44;
        }

        .acciones-section {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-accion {
            padding: 14px 35px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-factura {
            background: linear-gradient(135deg, #00cc44 0%, #00a638 100%);
            color: white;
        }

        .btn-factura:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 204, 68, 0.4);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.confirmado {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.pendiente {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.cancelado {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
  <header class="header">
    <div class="logo" style="cursor: default;">
      <img th:src="@{/frontend/imagenes/logo technova.png}" alt="Logo">
      <span>TECHNOVA</span>
    </div>

    <div class="acciones-usuario">
      <a th:href="@{/admin/perfil}" class="account"><i class='bx bx-user-circle'></i> <span>Perfil</span></a>
      <form method="POST" th:action="@{/logout}" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;display:inline-flex;align-items:center;gap:5px;" class="account">
          <i class='bx bx-log-out'></i> <span>Cerrar Sesión</span>
        </button>
      </form>
    </div>
  </header>

  <div class="dashboard-wrapper">
    <div th:replace="~{frontend/layouts/sidebar-admin :: sidebar}"></div>

    <main class="main-content">
      <div class="detalle-pago-container">
        <div class="detalle-header">
          <h2><i class='bx bx-receipt'></i> Detalle de Pago</h2>
          <a th:href="@{/admin/pagos}" class="btn-volver">
            <i class='bx bx-arrow-back'></i> Volver a Pagos
          </a>
        </div>

        <!-- Información del Pago -->
        <div class="detalle-card">
          <h3><i class='bx bx-credit-card'></i> Información del Pago</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ID de Pago</span>
              <span class="info-value" th:text="${pago.id}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Número de Factura</span>
              <span class="info-value" th:text="${pago.numeroFactura != null ? pago.numeroFactura : 'N/A'}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Fecha de Pago</span>
              <span class="info-value" th:text="${pago.fechaPago != null ? pago.fechaPago : 'N/A'}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Fecha de Factura</span>
              <span class="info-value" th:text="${pago.fechaFactura != null ? pago.fechaFactura : 'N/A'}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Estado</span>
              <span class="status-badge" 
                    th:classappend="${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'confirmado'} ? 'confirmado' : 
                                   (${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'pendiente'} ? 'pendiente' : 
                                   (${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'cancelado'} ? 'cancelado' : 
                                   (${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'procesado'} ? 'confirmado' : 
                                   (${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'aprobado'} ? 'confirmado' : 
                                   (${pago.estadoPago != null && #strings.toLowerCase(pago.estadoPago) == 'rechazado'} ? 'cancelado' : 'pendiente')))))"
                    th:text="${pago.estadoPago != null ? pago.estadoPago.toUpperCase() : 'N/A'}">
                Estado
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Monto Total</span>
              <span class="info-value amount">
                $<span th:text="${pago.monto != null ? #numbers.formatDecimal(pago.monto, 0, 'POINT', 2, 'POINT') : '0.00'}">0.00</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Información del Pedido/Venta -->
        <div class="detalle-card" th:if="${venta != null && venta.ventaId != null}">
          <h3><i class='bx bx-package'></i> Detalle del Pedido #<span th:text="${venta.ventaId}">N/A</span></h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ID de Venta</span>
              <span class="info-value" th:text="'#' + ${venta.ventaId}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Fecha de Venta</span>
              <span class="info-value" th:text="${venta.fechaVenta != null ? venta.fechaVenta : 'N/A'}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Total de la Venta</span>
              <span class="info-value amount">
                $<span th:text="${venta.total != null ? #numbers.formatDecimal(venta.total, 0, 'POINT', 2, 'POINT') : '0.00'}">0.00</span>
              </span>
            </div>
          </div>

          <!-- Productos -->
          <div class="productos-section" th:if="${venta != null && venta.items != null && !venta.items.isEmpty()}">
            <h4 style="margin-bottom: 15px; color: #2c3e50;">Productos (<span th:text="${venta.items.size()}">0</span>)</h4>
            <table class="productos-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio Unitario</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="item : ${venta.items}" th:if="${item != null}">
                  <td th:text="${item.nombreProducto != null ? item.nombreProducto : 'Producto N/A'}">Producto</td>
                  <td th:text="${item.cantidad != null ? item.cantidad : 1}">1</td>
                  <td>
                    <span th:if="${item.precioLinea != null && item.cantidad != null && item.cantidad > 0}">
                      $<span th:text="${#numbers.formatDecimal(item.precioLinea.doubleValue() / item.cantidad, 0, 'POINT', 2, 'POINT')}">0.00</span>
                    </span>
                    <span th:if="${item.cantidad == null || item.cantidad == 0}">$0.00</span>
                  </td>
                  <td style="color: #00cc44; font-weight: 600;">
                    $<span th:text="${item.precioLinea != null ? #numbers.formatDecimal(item.precioLinea, 0, 'POINT', 2, 'POINT') : '0.00'}">0.00</span>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="total-section">
              <span class="total-label">Total del Pedido:</span>
              <span class="total-amount">
                $<span th:text="${venta.total != null ? #numbers.formatDecimal(venta.total, 0, 'POINT', 2, 'POINT') : '0.00'}">0.00</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Información del Cliente -->
        <div class="detalle-card" th:if="${cliente != null}">
          <h3><i class='bx bx-user'></i> Información del Cliente</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Nombre</span>
              <span class="info-value" th:text="${cliente.name != null ? cliente.name : 'N/A'}">N/A</span>
            </div>
            <div class="info-item">
              <span class="info-label">Email</span>
              <span class="info-value" th:text="${cliente.email != null ? cliente.email : 'N/A'}">N/A</span>
            </div>
            <div class="info-item" th:if="${cliente.phone != null}">
              <span class="info-label">Teléfono</span>
              <span class="info-value" th:text="${cliente.phone}">N/A</span>
            </div>
            <div class="info-item" th:if="${cliente.address != null}">
              <span class="info-label">Dirección</span>
              <span class="info-value" th:text="${cliente.address}">N/A</span>
            </div>
            <div class="info-item" th:if="${cliente.documentType != null && cliente.documentNumber != null}">
              <span class="info-label">Documento</span>
              <span class="info-value" th:text="${cliente.documentType + ': ' + cliente.documentNumber}">N/A</span>
            </div>
          </div>
        </div>

        <!-- Acciones -->
        <div class="acciones-section">
          <a th:href="@{'/admin/pagos/factura/' + ${pago.id}}" 
             class="btn-accion btn-factura"
             target="_blank">
            <i class='bx bx-file-blank'></i> Generar Factura PDF
          </a>
        </div>
      </div>
    </main>
  </div>

  <footer>
    <p>&copy; 2025 Technova</p>
  </footer>
</body>
</html>

