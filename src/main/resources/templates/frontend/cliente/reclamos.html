<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="_csrf" th:content="${_csrf != null ? _csrf.token : ''}"/>
    <meta name="_csrf_header" th:content="${_csrf != null ? _csrf.headerName : ''}"/>
    <title>Reclamos - Technova</title>
    <!-- Boxicons con fallback -->
    <link href='https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet' crossorigin='anonymous' referrerpolicy='no-referrer' id="boxicons-link">
    <script>
      // Fallback para boxicons si falla la carga
      document.addEventListener('DOMContentLoaded', function() {
        var link = document.getElementById('boxicons-link');
        if (link) {
          link.onerror = function() {
            this.onerror = null;
            var fallback = document.createElement('link');
            fallback.rel = 'stylesheet';
            fallback.href = 'https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css';
            fallback.crossOrigin = 'anonymous';
            document.head.appendChild(fallback);
          };
        }
      });
    </script>
    <link rel="stylesheet" th:href="@{/frontend/css/estilodas.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/stilotech.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/color-palette.css}">
    
    <!-- Scripts globales - DEBEN estar en el head para estar disponibles antes del onclick -->
    <script>
      // Definir funciones globales INMEDIATAMENTE para que estén disponibles en onclick
      // Estas funciones deben estar disponibles antes de que se cargue el DOM
      window.mostrarFormulario = function() {
        var form = document.getElementById('reclamoForm');
        if (form) {
          form.classList.toggle('active');
        } else {
          console.error('No se encontró el formulario de reclamo');
        }
      };

      window.cerrarModal = function() {
        var modal = document.getElementById('reclamoModal');
        if (modal) {
          modal.classList.remove('active');
        } else {
          console.error('No se encontró el modal de reclamo');
        }
      };

      // Función global para evaluar reclamo - debe estar disponible inmediatamente
      window.evaluarReclamo = function(reclamoId, evaluacion) {
        if (!reclamoId || !evaluacion) {
          alert('Error: Faltan datos para evaluar el reclamo');
          return;
        }

        var csrfToken = document.querySelector('meta[name="_csrf"]') ? document.querySelector('meta[name="_csrf"]').content : '';
        var csrfHeaderName = document.querySelector('meta[name="_csrf_header"]') ? document.querySelector('meta[name="_csrf_header"]').content : '';
        
        var headers = {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        };
        
        if (csrfToken && csrfHeaderName) {
          headers[csrfHeaderName] = csrfToken;
        }

        fetch('/api/reclamos/' + reclamoId + '/evaluar-resolucion', {
          method: 'PUT',
          headers: headers,
          body: JSON.stringify({ evaluacion: evaluacion })
        })
        .then(response => {
          if (!response.ok) {
            return response.text().then(t => { throw new Error(t || 'Error al evaluar el reclamo'); });
          }
          return response.json();
        })
        .then(data => {
          alert('Evaluación registrada correctamente');
          location.reload();
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error al evaluar el reclamo: ' + error.message);
        });
      };
    </script>
    
    <style>
        .welcome-section {
            background: linear-gradient(to right, #DD6371 0%, #D83141 3%, #D83141 97%, #DD6371 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .welcome-section h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 700;
        }
        .reclamos-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .reclamos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }
        .btn-new-reclamo {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .reclamo-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }
        .reclamo-form.active {
            display: block;
        }
        .reclamos-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .reclamo-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .reclamo-card:hover {
            border-color: #dc3545;
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.15);
            transform: translateY(-3px);
        }
        .reclamo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        .reclamo-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .status-badge.status-resuelto {
            background: #d4edda;
            color: #155724;
        }
        .status-badge.status-en_revision {
            background: #d1ecf1;
            color: #0c5460;
        }
        .status-badge.status-pendiente {
            background: #fff3cd;
            color: #856404;
        }
        .priority-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .priority-baja { background: #d4edda; color: #155724; }
        .priority-normal { background: #d1ecf1; color: #0c5460; }
        .priority-alta { background: #fff3cd; color: #856404; }
        .priority-urgente { background: #f8d7da; color: #721c24; }
        .reclamo-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .reclamo-modal.active {
            display: flex;
        }
        .reclamo-modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .reclamo-modal-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .reclamo-modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }
    </style>
</head>
<body>
  <header class="header">
    <a th:href="@{/}" class="logo">
      <img th:src="@{/frontend/imagenes/logo technova.png}" alt="Logo">
      <span>TECHNOVA</span>
    </a>
    <div class="acciones-usuario">
      <a th:href="@{/cliente/perfil}" class="account"><i class='bx bx-user-circle'></i> <span>Perfil</span></a>
      <a th:href="@{/cliente/atencion-cliente}" class="account"><i class='bx bx-headphone'></i> <span>Atención al Cliente</span></a>
      <form method="POST" th:action="@{/logout}" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;display:inline-flex;align-items:center;gap:5px;" class="account">
          <i class='bx bx-log-out'></i> <span>Cerrar Sesión</span>
        </button>
      </form>
    </div>
  </header>

  <div class="dashboard-wrapper">
    <div th:replace="~{frontend/layouts/sidebar-cliente :: sidebar}"></div>
    <main class="main-content">
      <div class="welcome-section">
        <h1 style="color: #000000;"><i class='bx bx-error-circle'></i> Reclamos</h1>
        <p>Si tienes algún problema o insatisfacción, puedes presentar un reclamo formal.</p>
      </div>

      <div class="reclamos-section">
        <div class="reclamos-header">
          <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
            <i class='bx bx-error-circle'></i> Mis Reclamos
          </h2>
          <button class="btn-new-reclamo" onclick="mostrarFormulario()">
            <i class='bx bx-plus'></i> Nuevo Reclamo
          </button>
        </div>

        <div class="reclamo-form" id="reclamoForm">
          <form id="newReclamoForm">
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Título del Reclamo</label>
              <input type="text" id="titulo" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Prioridad</label>
              <select id="prioridad" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                <option value="normal">Normal</option>
                <option value="baja">Baja</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Descripción</label>
              <textarea id="descripcion" required rows="5" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; resize: vertical;"></textarea>
            </div>
            <button type="submit" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500;">
              <i class='bx bx-send'></i> Enviar Reclamo
            </button>
          </form>
        </div>

        <div class="reclamos-list" th:if="${reclamos != null && !reclamos.isEmpty()}">
          <div class="reclamo-card" th:each="reclamo : ${reclamos}" th:data-reclamo-id="${reclamo.id}">
            <div class="reclamo-header">
              <h3 th:text="${reclamo.titulo != null ? reclamo.titulo : 'Sin título'}">Título</h3>
              <div style="display: flex; gap: 10px; align-items: center;">
                <span th:classappend="'priority-badge priority-' + (${reclamo.prioridad != null ? #strings.toLowerCase(reclamo.prioridad) : 'normal'})" 
                      th:text="${reclamo.prioridad != null ? #strings.capitalize(reclamo.prioridad) : 'Normal'}">Prioridad</span>
                <span th:classappend="'status-badge status-' + (${reclamo.respuesta != null && !#strings.isEmpty(reclamo.respuesta)} ? 'resuelto' : (${reclamo.estado != null ? #strings.toLowerCase(reclamo.estado) : 'pendiente'}))" class="status-badge">
                  <th:block th:if="${reclamo.respuesta != null && !#strings.isEmpty(reclamo.respuesta)}">
                    <i class='bx bx-check-circle'></i> Resuelto
                  </th:block>
                  <th:block th:if="${reclamo.respuesta == null || #strings.isEmpty(reclamo.respuesta)}">
                    <i th:if="${reclamo.estado == 'pendiente'}" class='bx bx-time-five'></i>
                    <i th:if="${reclamo.estado == 'en_revision'}" class='bx bx-loader'></i>
                    <span th:text="${reclamo.estado != null ? #strings.capitalize(reclamo.estado) : 'Pendiente'}">Estado</span>
                  </th:block>
                </span>
              </div>
            </div>
            <div style="margin-bottom: 15px;">
              <p style="color: #495057; line-height: 1.6; margin: 0 0 15px 0;" th:text="${reclamo.descripcion != null ? reclamo.descripcion : 'Sin descripción'}">Descripción</p>
              <div style="display: flex; gap: 15px; color: #6c757d; font-size: 0.85rem;">
                <span><i class='bx bx-calendar'></i> <span th:text="${reclamo.fechaReclamo != null ? #temporals.format(reclamo.fechaReclamo, 'dd/MM/yyyy HH:mm') : 'N/A'}">Fecha</span></span>
              </div>
            </div>
            <th:block th:if="${reclamo.respuesta != null && !#strings.isEmpty(reclamo.respuesta)}">
              <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e9ecef; background: #f8f9fa; border-radius: 8px; padding: 15px;">
                <h4 style="color: #dc3545; margin-bottom: 12px; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                  <i class='bx bx-message-check'></i> Respuesta del Administrador:
                </h4>
                <p style="background: white; padding: 12px 15px; border-radius: 8px; color: #2c3e50; margin: 0 0 15px 0; line-height: 1.6; border-left: 3px solid #28a745;" th:text="${reclamo.respuesta}">Respuesta</p>
                
                <th:block th:if="${reclamo.evaluacionCliente == null || #strings.isEmpty(reclamo.evaluacionCliente)}">
                  <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #e9ecef;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #2c3e50;">¿Consideras que tu queja fue resuelta?</p>
                    <div style="display: flex; gap: 10px;">
                      <button class="btn-evaluar-resuelta" 
                              th:data-reclamo-id="${reclamo.id}"
                              data-evaluacion="resuelta"
                              style="flex: 1; padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;"
                              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.3)';"
                              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <i class='bx bx-check-circle'></i> Sí, fue resuelta
                      </button>
                      <button class="btn-evaluar-no-resuelta" 
                              th:data-reclamo-id="${reclamo.id}"
                              data-evaluacion="no_resuelta"
                              style="flex: 1; padding: 10px 20px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;"
                              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(220, 53, 69, 0.3)';"
                              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <i class='bx bx-x-circle'></i> No fue resuelta
                      </button>
                    </div>
                  </div>
                </th:block>
                <th:block th:if="${reclamo.evaluacionCliente != null && !#strings.isEmpty(reclamo.evaluacionCliente)}">
                  <div style="margin-top: 15px; padding: 12px 15px; background: white; border-radius: 8px; border-left: 4px solid #28a745;">
                    <p style="margin: 0; font-weight: 600; color: #2c3e50; display: flex; align-items: center; gap: 8px;">
                      <i th:if="${reclamo.evaluacionCliente == 'resuelta'}" class='bx bx-check-circle' style="color: #28a745;"></i>
                      <i th:if="${reclamo.evaluacionCliente == 'no_resuelta'}" class='bx bx-x-circle' style="color: #dc3545;"></i>
                      <span th:text="${reclamo.evaluacionCliente == 'resuelta' ? 'Has indicado que la queja fue resuelta' : 'Has indicado que la queja no fue resuelta'}">Evaluación</span>
                    </p>
                  </div>
                </th:block>
              </div>
            </th:block>
          </div>
        </div>
        <div th:if="${reclamos == null || reclamos.isEmpty()}" style="text-align: center; padding: 40px; color: #6c757d;">
          <i class='bx bx-error-circle' style="font-size: 3rem; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
          <h3>No tienes reclamos</h3>
          <p>Crea tu primer reclamo si tienes algún problema o insatisfacción</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal de Detalle -->
  <div id="reclamoModal" class="reclamo-modal">
    <div class="reclamo-modal-content">
      <div class="reclamo-modal-header">
        <h3 id="reclamoModalTitle">Detalle de Reclamo</h3>
        <button onclick="cerrarModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">
          <i class='bx bx-x'></i>
        </button>
      </div>
      <div class="reclamo-modal-body" id="reclamoModalBody"></div>
    </div>
  </div>

  <script th:inline="javascript">
    var datosIniciales = {
      usuarioId: /*[[${usuario != null ? usuario.id : null}]]*/ null
    };
  </script>
  <script>
    // Inicializar todo cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar formulario de nuevo reclamo
      var newReclamoForm = document.getElementById('newReclamoForm');
      if (newReclamoForm) {
        newReclamoForm.addEventListener('submit', function(e) {
          e.preventDefault();
          var titulo = document.getElementById('titulo').value.trim();
          var descripcion = document.getElementById('descripcion').value.trim();
          var prioridad = document.getElementById('prioridad').value;

          if (!titulo || !descripcion) {
            alert('Por favor completa todos los campos');
            return;
          }

          var formData = new URLSearchParams();
          formData.append('usuarioId', datosIniciales.usuarioId.toString());
          formData.append('titulo', titulo);
          formData.append('descripcion', descripcion);
          formData.append('prioridad', prioridad);

          // Agregar token CSRF
          var csrfToken = document.querySelector('meta[name="_csrf"]') ? document.querySelector('meta[name="_csrf"]').content : '';
          var csrfHeaderName = document.querySelector('meta[name="_csrf_header"]') ? document.querySelector('meta[name="_csrf_header"]').content : '';
          
          var headers = {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-Requested-With': 'XMLHttpRequest'
          };
          
          // Agregar token CSRF al header si está disponible
          if (csrfToken && csrfHeaderName) {
            headers[csrfHeaderName] = csrfToken;
          }

          fetch('/api/reclamos', {
            method: 'POST',
            headers: headers,
            body: formData.toString()
          })
          .then(response => response.ok ? response.json() : response.text().then(t => { throw new Error(t); }))
          .then(data => {
            alert('Reclamo enviado correctamente');
            location.reload();
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al enviar el reclamo: ' + error.message);
          });
        });
      }

      // Usar event delegation para los botones de evaluación (más robusto)
      // Esto funciona incluso si los botones se agregan dinámicamente
      document.addEventListener('click', function(e) {
        // Botones de evaluación en las tarjetas
        if (e.target.closest('.btn-evaluar-resuelta, .btn-evaluar-no-resuelta')) {
          e.stopPropagation();
          e.preventDefault();
          var button = e.target.closest('.btn-evaluar-resuelta, .btn-evaluar-no-resuelta');
          var reclamoId = button.getAttribute('data-reclamo-id');
          var evaluacion = button.getAttribute('data-evaluacion');
          if (reclamoId && evaluacion && window.evaluarReclamo) {
            window.evaluarReclamo(parseInt(reclamoId), evaluacion);
          } else {
            console.error('Error: No se pudo obtener los datos del botón', {reclamoId, evaluacion});
            alert('Error al evaluar el reclamo. Por favor recarga la página.');
          }
          return;
        }
        
        // Botones de evaluación en el modal
        if (e.target.closest('.btn-evaluar-modal-resuelta, .btn-evaluar-modal-no-resuelta')) {
          e.stopPropagation();
          e.preventDefault();
          var button = e.target.closest('.btn-evaluar-modal-resuelta, .btn-evaluar-modal-no-resuelta');
          var reclamoId = button.getAttribute('data-reclamo-id');
          var evaluacion = button.getAttribute('data-evaluacion');
          if (reclamoId && evaluacion && window.evaluarReclamo) {
            window.evaluarReclamo(parseInt(reclamoId), evaluacion);
          } else {
            console.error('Error: No se pudo obtener los datos del botón del modal', {reclamoId, evaluacion});
            alert('Error al evaluar el reclamo. Por favor recarga la página.');
          }
          return;
        }
      });

      // Prevenir que los botones dentro de la tarjeta activen el click de la tarjeta
      setTimeout(function() {
        document.querySelectorAll('.reclamo-card button').forEach(button => {
          if (!button.classList.contains('btn-evaluar-resuelta') && 
              !button.classList.contains('btn-evaluar-no-resuelta') &&
              !button.classList.contains('btn-evaluar-modal-resuelta') &&
              !button.classList.contains('btn-evaluar-modal-no-resuelta')) {
            button.addEventListener('click', function(e) {
              e.stopPropagation();
            });
          }
        });

        document.querySelectorAll('.reclamo-card').forEach(card => {
        card.addEventListener('click', function(e) {
          // Si el click fue en un botón, no hacer nada
          if (e.target.closest('button')) {
            return;
          }
          
          var reclamoId = this.getAttribute('data-reclamo-id');
          if (!reclamoId) {
            console.error('No se encontró el ID del reclamo');
            return;
          }

          fetch('/api/reclamos/' + reclamoId)
            .then(response => {
              if (!response.ok) {
                throw new Error('Error al cargar el reclamo: ' + response.status);
              }
              return response.json();
            })
            .then(reclamo => {
              var tieneRespuesta = reclamo.respuesta != null && reclamo.respuesta.trim() !== '';
              var tieneEvaluacion = reclamo.evaluacionCliente != null && reclamo.evaluacionCliente.trim() !== '';
              
              var html = '<div><div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;"><span style="color: #6c757d; font-size: 0.9rem;"><i class="bx bx-calendar"></i> ' + 
                        (reclamo.fechaReclamo ? new Date(reclamo.fechaReclamo).toLocaleString('es-ES') : 'N/A') + '</span>' +
                        '<span class="status-badge status-' + (tieneRespuesta ? 'resuelto' : (reclamo.estado || 'pendiente')) + '">' +
                        (tieneRespuesta ? '<i class="bx bx-check-circle"></i> Resuelto' : '<i class="bx bx-loader"></i> ' + (reclamo.estado || 'Pendiente')) + '</span></div>' +
                        '<div style="margin-bottom: 20px;"><h4>Descripción:</h4><p style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">' + 
                        (reclamo.descripcion || 'Sin descripción') + '</p></div>';
              
              if (tieneRespuesta) {
                html += '<div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e9ecef;"><h4 style="color: #dc3545;">Respuesta:</h4><p style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">' + reclamo.respuesta + '</p>';
                
                if (!tieneEvaluacion) {
                  html += '<div style="padding: 15px; background: white; border-radius: 8px; border: 2px solid #e9ecef;"><p style="margin: 0 0 12px 0; font-weight: 600; color: #2c3e50;">¿Consideras que tu queja fue resuelta?</p>' +
                          '<div style="display: flex; gap: 10px;"><button class="btn-evaluar-modal-resuelta" data-reclamo-id="' + reclamo.id + '" data-evaluacion="resuelta" style="flex: 1; padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;"><i class="bx bx-check-circle"></i> Sí, fue resuelta</button>' +
                          '<button class="btn-evaluar-modal-no-resuelta" data-reclamo-id="' + reclamo.id + '" data-evaluacion="no_resuelta" style="flex: 1; padding: 10px 20px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;"><i class="bx bx-x-circle"></i> No fue resuelta</button></div></div>';
                } else {
                  html += '<div style="padding: 12px 15px; background: white; border-radius: 8px; border-left: 4px solid #28a745;"><p style="margin: 0; font-weight: 600; color: #2c3e50;"><i class="bx ' + (reclamo.evaluacionCliente === 'resuelta' ? 'bx-check-circle' : 'bx-x-circle') + '" style="color: ' + (reclamo.evaluacionCliente === 'resuelta' ? '#28a745' : '#dc3545') + ';"></i> ' +
                          (reclamo.evaluacionCliente === 'resuelta' ? 'Has indicado que la queja fue resuelta' : 'Has indicado que la queja no fue resuelta') + '</p></div>';
                }
                html += '</div>';
              }
              
              html += '</div>';
              document.getElementById('reclamoModalTitle').textContent = reclamo.titulo || 'Sin título';
              document.getElementById('reclamoModalBody').innerHTML = html;
              document.getElementById('reclamoModal').classList.add('active');
              
              // Los event listeners ya están configurados con event delegation, no necesitamos agregarlos aquí
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error al cargar el reclamo: ' + error.message);
            });
        });
      });
      }, 100);
    });
  </script>
</body>
</html>

