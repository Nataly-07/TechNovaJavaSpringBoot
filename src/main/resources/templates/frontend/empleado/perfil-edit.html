<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Editar Perfil - Empleado - Technova</title>
    <link rel="icon" type="image/png" th:href="@{/frontend/imagenes/logo technova.png}">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" th:href="@{/frontend/css/estilodas.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/stilotech.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/color-palette.css}">
    <style>
        .edit-profile-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 30px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
        }

        .edit-profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .edit-profile-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin: 0;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #e2e8f0;
            color: #4a5568;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #cbd5e0;
            color: #2d3748;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            flex: 1;
        }

        .form-group.full-width {
            flex: 1 1 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group label .required {
            color: #ef4444;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: #f8fafc;
            color: #2d3748;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input[readonly] {
            background: #f1f5f9;
            color: #64748b;
            cursor: not-allowed;
            border-color: #cbd5e0;
        }

        .form-group input[readonly]:focus {
            border-color: #cbd5e0;
            box-shadow: none;
            background: #f1f5f9;
        }

        .form-group input.editable {
            background: white;
            border-color: #667eea;
        }

        .field-note {
            font-size: 12px;
            color: #718096;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .field-note i {
            font-size: 14px;
        }

        .error-message {
            color: #ef4444;
            font-size: 14px;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .error-message i {
            font-size: 16px;
        }

        .success-message {
            color: #10b981;
            font-size: 14px;
            margin-bottom: 20px;
            padding: 12px 16px;
            background: #d1fae5;
            border-radius: 8px;
            border: 1px solid #10b981;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }

        .btn-save {
            padding: 14px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-cancel {
            padding: 14px 30px;
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
            color: #2d3748;
        }

        /* Modal de Confirmación */
        .success-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .success-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 24px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            transform: scale(0.8) translateY(-20px);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            border: 2px solid rgba(16, 185, 129, 0.2);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes modalSlideIn {
            to {
                transform: scale(1) translateY(0);
            }
        }

        .success-icon-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 25px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: iconPulse 2s ease-in-out infinite;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
        }

        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 15px 50px rgba(16, 185, 129, 0.6);
            }
        }

        .success-icon-container::before {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.2);
            animation: ripple 2s ease-out infinite;
        }

        @keyframes ripple {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.4);
                opacity: 0;
            }
        }

        .success-icon {
            font-size: 60px;
            color: white;
            position: relative;
            z-index: 1;
            animation: checkmark 0.6s ease-out 0.2s both;
        }

        @keyframes checkmark {
            0% {
                transform: scale(0) rotate(-45deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            animation: slideDown 0.5s ease-out 0.3s both;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-message-modal {
            font-size: 16px;
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 0;
            animation: slideDown 0.5s ease-out 0.4s both;
        }

        .success-modal-overlay.closing {
            animation: fadeOut 0.3s ease-out forwards;
        }

        .success-modal-overlay.closing .success-modal {
            animation: modalSlideOut 0.3s ease-out forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        @keyframes modalSlideOut {
            to {
                transform: scale(0.8) translateY(-20px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
  <header class="header">
    <div class="logo" style="cursor: default;">
      <img th:src="@{/frontend/imagenes/logo technova.png}" alt="Logo">
      <span>TECHNOVA</span>
    </div>

    <div class="acciones-usuario">
      <a th:href="@{/empleado/perfil}" class="account"><i class='bx bx-user-circle'></i> <span>Perfil</span></a>
      <form method="POST" th:action="@{/logout}" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;display:inline-flex;align-items:center;gap:5px;" class="account">
          <i class='bx bx-log-out'></i> <span>Cerrar Sesión</span>
        </button>
      </form>
    </div>
  </header>

  <div class="dashboard-wrapper">
    <div th:replace="~{frontend/layouts/sidebar-empleado :: sidebar}"></div>

    <main class="main-content">
      <div class="edit-profile-container">
        <div class="edit-profile-header">
          <h1><i class='bx bx-edit'></i> Editar Perfil</h1>
          <a th:href="@{/empleado/perfil}" class="back-button">
            <i class='bx bx-arrow-back'></i> Volver al Perfil
          </a>
        </div>

        <!-- Mensajes de éxito y error -->
        <div th:if="${success}" class="success-message">
          <i class='bx bx-check-circle'></i>
          <span th:text="${success}">Perfil actualizado exitosamente</span>
        </div>

        <div th:if="${error}" class="error-message" style="margin-bottom: 20px; padding: 12px 16px; background: #fee2e2; border-radius: 8px; border: 1px solid #ef4444;">
          <i class='bx bx-error-circle'></i>
          <span th:text="${error}">Error al actualizar el perfil</span>
        </div>

        <form id="edit-profile-form" method="POST" th:action="@{/empleado/perfil/update}">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

          <!-- Información Personal (Solo lectura) -->
          <div class="form-section">
            <h2 class="section-title">Información Personal</h2>
            
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">Nombre</label>
                <input type="text" id="firstName" th:value="${usuario.firstName}" readonly />
                <div class="field-note">
                  <i class='bx bx-lock'></i>
                  <span>Campo de solo lectura</span>
                </div>
              </div>

              <div class="form-group">
                <label for="lastName">Apellido</label>
                <input type="text" id="lastName" th:value="${usuario.lastName}" readonly />
                <div class="field-note">
                  <i class='bx bx-lock'></i>
                  <span>Campo de solo lectura</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="email">Correo Electrónico</label>
              <input type="email" id="email" th:value="${usuario.email}" readonly />
              <div class="field-note">
                <i class='bx bx-lock'></i>
                <span>Campo de solo lectura</span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group" style="flex: 0 0 40%;">
                <label for="documentType">Tipo de Documento</label>
                <input type="text" id="documentType" th:value="${usuario.documentType}" readonly />
                <div class="field-note">
                  <i class='bx bx-lock'></i>
                  <span>Campo de solo lectura</span>
                </div>
              </div>

              <div class="form-group" style="flex: 1;">
                <label for="documentNumber">Número de Documento</label>
                <input type="text" id="documentNumber" th:value="${usuario.documentNumber}" readonly />
                <div class="field-note">
                  <i class='bx bx-lock'></i>
                  <span>Campo de solo lectura</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Información de Contacto (Editable) -->
          <div class="form-section">
            <h2 class="section-title">Información de Contacto <span style="color: #667eea; font-size: 14px;">(Editable)</span></h2>
            
            <div class="form-group">
              <label for="phone">Teléfono <span class="required">*</span></label>
              <input type="tel" 
                     id="phone" 
                     name="phone" 
                     th:value="${usuario.phone}" 
                     class="editable"
                     required
                     placeholder="Tu teléfono celular"
                     pattern="[0-9]{10}"
                     maxlength="10" />
              <div class="error-message" id="phoneError" style="display: none;"></div>
            </div>

            <div class="form-group full-width">
              <label for="address">Dirección de Residencia <span class="required">*</span></label>
              <input type="text" 
                     id="address" 
                     name="address" 
                     th:value="${usuario.address}" 
                     class="editable"
                     required
                     placeholder="Tu dirección completa" />
              <div class="error-message" id="addressError" style="display: none;"></div>
            </div>
          </div>

          <!-- Seguridad (Editable) -->
          <div class="form-section">
            <h2 class="section-title">Seguridad <span style="color: #667eea; font-size: 14px;">(Opcional)</span></h2>
            
            <div class="form-group">
              <label for="password">Nueva Contraseña</label>
              <input type="password" 
                     id="password" 
                     name="password" 
                     class="editable"
                     placeholder="Dejar en blanco para mantener la actual"
                     minlength="8" />
              <div class="field-note">
                <i class='bx bx-info-circle'></i>
                <span>Mínimo 8 caracteres. Dejar vacío si no deseas cambiar la contraseña.</span>
              </div>
              <div class="error-message" id="passwordError" style="display: none;"></div>
            </div>

            <div class="form-group">
              <label for="passwordConfirm">Confirmar Nueva Contraseña</label>
              <input type="password" 
                     id="passwordConfirm" 
                     name="passwordConfirm" 
                     class="editable"
                     placeholder="Confirma tu nueva contraseña" />
              <div class="error-message" id="passwordConfirmError" style="display: none;"></div>
            </div>
          </div>

          <div class="form-actions">
            <a th:href="@{/empleado/perfil}" class="btn-cancel">
              <i class='bx bx-x'></i> Cancelar
            </a>
            <button type="submit" class="btn-save">
              <i class='bx bx-save'></i> Guardar Cambios
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Modal de Confirmación -->
  <div id="successModal" class="success-modal-overlay" style="display: none;">
    <div class="success-modal">
      <div class="success-icon-container">
        <i class='bx bx-check-circle success-icon'></i>
      </div>
      <h2 class="success-title">¡Perfil Actualizado!</h2>
      <p class="success-message-modal">
        Los cambios han sido guardados correctamente.
      </p>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Technova</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('edit-profile-form');
      const phoneInput = document.getElementById('phone');
      const addressInput = document.getElementById('address');
      const passwordInput = document.getElementById('password');
      const passwordConfirmInput = document.getElementById('passwordConfirm');

      // Validación de teléfono
      phoneInput.addEventListener('input', function() {
        const phone = this.value.trim();
        const errorDiv = document.getElementById('phoneError');
        
        if (phone.length > 0 && (phone.length !== 10 || !/^\d+$/.test(phone))) {
          errorDiv.textContent = 'El teléfono debe tener 10 dígitos.';
          errorDiv.style.display = 'flex';
          this.style.borderColor = '#ef4444';
        } else {
          errorDiv.style.display = 'none';
          if (phone.length > 0) {
            this.style.borderColor = '#10b981';
          } else {
            this.style.borderColor = '#e2e8f0';
          }
        }
      });

      // Validación de dirección
      addressInput.addEventListener('input', function() {
        const address = this.value.trim();
        const errorDiv = document.getElementById('addressError');
        
        if (address.length > 0 && address.length < 8) {
          errorDiv.textContent = 'La dirección debe tener al menos 8 caracteres.';
          errorDiv.style.display = 'flex';
          this.style.borderColor = '#ef4444';
        } else {
          errorDiv.style.display = 'none';
          if (address.length > 0) {
            this.style.borderColor = '#10b981';
          } else {
            this.style.borderColor = '#e2e8f0';
          }
        }
      });

      // Validación de contraseña
      passwordInput.addEventListener('input', function() {
        const password = this.value;
        const errorDiv = document.getElementById('passwordError');
        
        if (password.length > 0 && password.length < 8) {
          errorDiv.textContent = 'La contraseña debe tener al menos 8 caracteres.';
          errorDiv.style.display = 'flex';
          this.style.borderColor = '#ef4444';
        } else {
          errorDiv.style.display = 'none';
          if (password.length > 0) {
            this.style.borderColor = '#10b981';
          } else {
            this.style.borderColor = '#e2e8f0';
          }
        }
        
        // Validar confirmación si hay valor
        if (passwordConfirmInput.value.length > 0) {
          validatePasswordConfirm();
        }
      });

      // Validación de confirmación de contraseña
      passwordConfirmInput.addEventListener('input', validatePasswordConfirm);

      function validatePasswordConfirm() {
        const password = passwordInput.value;
        const passwordConfirm = passwordConfirmInput.value;
        const errorDiv = document.getElementById('passwordConfirmError');
        
        if (password.length > 0 && passwordConfirm.length > 0) {
          if (password !== passwordConfirm) {
            errorDiv.textContent = 'Las contraseñas no coinciden.';
            errorDiv.style.display = 'flex';
            passwordConfirmInput.style.borderColor = '#ef4444';
          } else {
            errorDiv.style.display = 'none';
            passwordConfirmInput.style.borderColor = '#10b981';
          }
        } else if (passwordConfirm.length > 0 && password.length === 0) {
          errorDiv.textContent = 'Primero ingresa la nueva contraseña.';
          errorDiv.style.display = 'flex';
          passwordConfirmInput.style.borderColor = '#ef4444';
        } else {
          errorDiv.style.display = 'none';
          passwordConfirmInput.style.borderColor = '#e2e8f0';
        }
      }

      // Validación del formulario
      form.addEventListener('submit', function(event) {
        let hasErrors = false;

        // Validar teléfono
        const phone = phoneInput.value.trim();
        if (!phone || phone.length !== 10 || !/^\d+$/.test(phone)) {
          document.getElementById('phoneError').textContent = 'El teléfono es obligatorio y debe tener 10 dígitos.';
          document.getElementById('phoneError').style.display = 'flex';
          phoneInput.style.borderColor = '#ef4444';
          hasErrors = true;
        }

        // Validar dirección
        const address = addressInput.value.trim();
        if (!address || address.length < 8) {
          document.getElementById('addressError').textContent = 'La dirección es obligatoria y debe tener al menos 8 caracteres.';
          document.getElementById('addressError').style.display = 'flex';
          addressInput.style.borderColor = '#ef4444';
          hasErrors = true;
        }

        // Validar contraseña si se ingresó
        const password = passwordInput.value.trim();
        if (password.length > 0) {
          if (password.length < 8) {
            document.getElementById('passwordError').textContent = 'La contraseña debe tener al menos 8 caracteres.';
            document.getElementById('passwordError').style.display = 'flex';
            passwordInput.style.borderColor = '#ef4444';
            hasErrors = true;
          }

          const passwordConfirm = passwordConfirmInput.value.trim();
          if (!passwordConfirm || password !== passwordConfirm) {
            document.getElementById('passwordConfirmError').textContent = 'Las contraseñas deben coincidir.';
            document.getElementById('passwordConfirmError').style.display = 'flex';
            passwordConfirmInput.style.borderColor = '#ef4444';
            hasErrors = true;
          }
        }

        if (hasErrors) {
          event.preventDefault();
          return false;
        }

        // Si todo está bien, el formulario se enviará normalmente
      });

      // Mostrar modal si hay mensaje de éxito
      const successMessage = document.querySelector('.success-message');
      if (successMessage && successMessage.style.display !== 'none') {
        setTimeout(() => {
          const successModal = document.getElementById('successModal');
          if (successModal) {
            successModal.style.display = 'flex';
            
            setTimeout(() => {
              successModal.classList.add('closing');
              setTimeout(() => {
                successModal.style.display = 'none';
                successModal.classList.remove('closing');
              }, 300);
            }, 2500);
          }
        }, 300);
      }
    });
  </script>
</body>
</html>

