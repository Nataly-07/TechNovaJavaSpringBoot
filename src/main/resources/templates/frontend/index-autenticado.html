<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Technova - Bienvenido</title>
  <link rel="stylesheet" th:href="@{/frontend/css/stilotech.css}">
  <link rel="stylesheet" th:href="@{/frontend/css/producto.css}">
</head>
<body>
<header class="header">
  <a th:href="@{/}" class="logo">
    <img th:src="@{/frontend/imagenes/logo technova.png}" alt="Logo" style="cursor:pointer;">
    <span>TECHNOVA</span>
  </a>

  <div class="busqueda-header-wrapper">
    <div class="busqueda-input-wrapper">
      <input type="text" id="busquedaTermino" class="busqueda-input" placeholder="Buscar productos..." 
             onkeypress="if(event.key === 'Enter') buscarProductos()">
      <button onclick="buscarProductos()" class="btn-buscar">
        <span>üîç</span>
      </button>
      <button onclick="limpiarFiltros()" class="btn-limpiar">
        <span>‚úï</span>
      </button>
      <button onclick="toggleFiltros()" class="btn-filtros-toggle" id="btnFiltrosToggle">
        <span>‚öôÔ∏è Filtros</span>
      </button>
    </div>
    <div class="filtros-header-container" id="filtrosContainer" style="display: none;">
      <div class="filtro-header-item">
        <label>MARCA</label>
        <select id="filtroMarca" class="filtro-select-header">
          <option value="">Todas</option>
          <option th:each="marca : ${marcas}" th:value="${marca}" th:text="${marca}">Marca</option>
        </select>
      </div>
      <div class="filtro-header-item">
        <label>CATEGOR√çA</label>
        <select id="filtroCategoria" class="filtro-select-header">
          <option value="">Todas</option>
          <option th:each="categoria : ${categorias}" th:value="${categoria}" th:text="${categoria}">Categor√≠a</option>
        </select>
      </div>
      <div class="filtro-header-item">
        <label>PRECIO M√çN</label>
        <input type="number" id="filtroPrecioMin" class="filtro-input-header" placeholder="0" min="0" step="0.01">
      </div>
      <div class="filtro-header-item">
        <label>PRECIO M√ÅX</label>
        <input type="number" id="filtroPrecioMax" class="filtro-input-header" placeholder="‚àû" min="0" step="0.01">
      </div>
      <div class="filtro-header-item">
        <label>DISPONIBILIDAD</label>
        <select id="filtroDisponibilidad" class="filtro-select-header">
          <option value="">Todas</option>
          <option value="disponible">Disponible</option>
          <option value="agotado">Agotado</option>
        </select>
      </div>
    </div>
  </div>

  <div class="acciones-usuario">
    <a th:href="@{/cliente/perfil}" class="account">
      <span>Perfil</span>
    </a>
    <a th:href="@{/favoritos}" class="account" style="position: relative;">
      <span>‚ù§Ô∏è Favoritos</span>
      <th:block th:if="${favoritosCount != null and favoritosCount > 0}">
        <span style="position:absolute; top:-6px; right:-6px; background:#e63946; color:#fff; border-radius:12px; padding:2px 6px; font-size:12px; line-height:1; font-weight:700;" th:text="${favoritosCount}">0</span>
      </th:block>
    </a>
    <div class="carrito-dropdown-container" style="position: relative;">
      <button class="account carrito-toggle-btn" style="position: relative; background: none; border: none; color: inherit; cursor: pointer; display: inline-flex; align-items: center; gap: 5px;">
        <span>üõí Carrito</span>
        <th:block th:if="${carritoCount != null and carritoCount > 0}">
          <span style="position:absolute; top:-6px; right:-6px; background:#e63946; color:#fff; border-radius:12px; padding:2px 6px; font-size:12px; line-height:1; font-weight:700;" th:text="${carritoCount}">0</span>
        </th:block>
      </button>
      <div class="carrito-dropdown" id="carritoDropdown" style="display: none;">
        <div class="carrito-dropdown-header">
          <h3>Mi Carrito</h3>
        </div>
        <div class="carrito-dropdown-content" id="carritoDropdownContent">
          <p style="text-align: center; padding: 20px; color: #666;">Cargando...</p>
        </div>
        <div class="carrito-dropdown-footer">
          <a th:href="@{/carrito}" class="btn-ir-carrito">Ir a Carrito</a>
        </div>
      </div>
    </div>
    <form method="POST" th:action="@{/logout}" style="display:inline;">
      <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;display:inline-flex;align-items:center;gap:5px;" class="account">
        <span>Cerrar Sesi√≥n</span>
      </button>
    </form>
  </div>
</header>
<nav class="menu-principal">
  <ul>
    <li><a th:href="@{/}">Inicio</a></li>
      <li class="submenu">
      <a href="#">Categor√≠as ‚ñæ</a>
      <ul class="submenu-lista">
        <li th:each="categoria : ${categorias}">
          <a th:href="@{'/categoria/' + ${#strings.toLowerCase(categoria)}}" th:text="${categoria}">Categor√≠a</a>
        </li>
      </ul>
    </li>
    <li class="submenu">
      <a href="#">Marcas ‚ñæ</a>
      <ul class="submenu-lista">
        <li th:each="marca : ${marcas}">
          <a th:href="@{'/marca/' + ${#strings.toLowerCase(marca)}}" th:text="${marca}">Marca</a>
        </li>
      </ul>
    </li>
  </ul>
</nav>

<!-- Resultados de b√∫squeda -->
<div class="busqueda-filtros-container">
    <div id="resultadosBusqueda" class="resultados-container">
        <h3 class="resultados-titulo">Resultados de b√∫squeda</h3>
        <div id="productosFiltrados" class="productos-grid"></div>
    </div>
</div>

<div class="mas-vendido-container" id="productosOriginales">
    <div class="mas-vendido-header">
      <span class="vendido">Lo m√°s vendido</span>
      <a href="#" class="ver-mas">Ver m√°s</a>
    </div>

    <div class="carrusel-productos-contenedor">
      <button class="carrusel-btn prev">&#10094;</button>

      <div class="carrusel-track">
        <div class="producto" th:each="producto : ${productos}">
          <img th:src="${producto.imagen != null and !#strings.isEmpty(producto.imagen) and #strings.startsWith(producto.imagen, 'http') 
                        ? producto.imagen 
                        : (producto.imagen != null and !#strings.isEmpty(producto.imagen) 
                            ? '/frontend/imagenes/' + producto.imagen 
                            : '/frontend/imagenes/placeholder.png')}"
               th:alt="${producto.nombre}">
          <a th:href="@{'/producto/' + ${producto.id}}"><span class="detalles">Ver M√°s Detalles</span></a>
          <h3 th:text="${producto.nombre}">Producto</h3>
          <!-- Indicador de disponibilidad -->
          <div style="margin: 5px 0;">
            <th:block th:with="stock=${producto.stock != null ? producto.stock : 0}">
              <span th:if="${stock > 0}" style="display: inline-flex; align-items: center; gap: 3px; background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                <span>‚úì</span>
                <span>Disponible</span>
              </span>
              <span th:if="${stock == 0}" style="display: inline-flex; align-items: center; gap: 3px; background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                <span>‚úó</span>
                <span>Agotado</span>
              </span>
            </th:block>
          </div>
          <p>4.5 ‚≠ê</p>
          <th:block th:if="${producto.precioOriginal != null and producto.precioDescuento != null}">
            <p class="precio-original">
              $<span th:text="${producto.precioOriginal}">0</span>
            </p>
            <p class="precio-descuento">
              $<span th:text="${producto.precioDescuento}">0</span>
              <span class="descuento">-5%</span>
            </p>
          </th:block>
          <div style="display: flex; gap: 8px; justify-content: center; align-items: center;">
            <form th:action="@{'/carrito/agregar/' + ${producto.id}}" method="POST" style="display: inline;">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <button type="submit" class="carrito-btn" style="text-decoration: none; color: white; display: inline-flex; align-items: center; justify-content: center; background: var(--gradient-secondary); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 18px; cursor: pointer;">&#128722;</button>
            </form>
            <button class="favorito-btn" th:data-producto-id="${producto.id}" style="background: #ff6b9d; border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 18px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease;">‚ù§Ô∏è</button>
          </div>
        </div>
      </div>

      <button class="carrusel-btn next">&#10095;</button>
    </div>
</div>

<div class="info-botones">
    <div class="info-btn">
        <span class="icon">&#128666;</span>
        <span>Envios<br>gratis</span>
    </div>
    <div class="info-btn">
        <span class="icon">&#128179;</span>
        <span>Metodos<br>de pago</span>
    </div>
    <div class="info-btn">
        <span class="icon">&#128100;</span>
        <span>Asistencia<br>virtual</span>
    </div>
</div>

<th:block th:if="${productosRecientes != null and !productosRecientes.isEmpty()}">
<div class="mas-vendido-container">
    <div class="mas-vendido-header">
        <span class="vendido">üÜï Productos Agregados Recientemente</span>
        <a href="#" class="ver-mas">Ver m√°s</a>
    </div>

    <div class="carrusel-productos-contenedor">
        <button class="carrusel-btn prev">&#10094;</button>

        <div class="carrusel-track">
            <div class="producto" th:each="producto : ${productosRecientes}">
                <img th:src="${producto.imagen != null and !#strings.isEmpty(producto.imagen) and #strings.startsWith(producto.imagen, 'http') 
                              ? producto.imagen 
                              : (producto.imagen != null and !#strings.isEmpty(producto.imagen) 
                                  ? '/frontend/imagenes/' + producto.imagen 
                                  : '/frontend/imagenes/placeholder.png')}"
                     th:alt="${producto.nombre}">
                <a th:href="@{'/producto/' + ${producto.id}}"><span class="detalles">Ver M√°s Detalles</span></a>
                <h3 th:text="${producto.nombre}">Producto</h3>
                <!-- Indicador de disponibilidad -->
                <div style="margin: 5px 0; display: block;">
                  <th:block th:with="stock=${producto.stock != null ? producto.stock : 0}">
                    <span th:if="${stock != null and stock > 0}" style="display: inline-flex !important; align-items: center; gap: 3px; background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                      <span>‚úì</span>
                      <span>Disponible</span>
                    </span>
                    <span th:if="${stock == null or stock == 0}" style="display: inline-flex !important; align-items: center; gap: 3px; background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                      <span>‚úó</span>
                      <span>Agotado</span>
                    </span>
                  </th:block>
                </div>
                <p>4.5 ‚≠ê</p>
                <th:block th:if="${producto.precioOriginal != null and producto.precioDescuento != null}">
                    <p class="precio-original">
                        $<span th:text="${producto.precioOriginal}">0</span>
                    </p>
                    <p class="precio-descuento">
                        $<span th:text="${producto.precioDescuento}">0</span>
                        <span class="descuento">-5%</span>
                    </p>
                </th:block>
                <div style="display: flex; gap: 8px; justify-content: center; align-items: center;">
                    <form th:action="@{'/carrito/agregar/' + ${producto.id}}" method="POST" style="display: inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="carrito-btn" style="text-decoration: none; color: white; display: inline-flex; align-items: center; justify-content: center; background: var(--gradient-secondary); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 18px; cursor: pointer;">&#128722;</button>
                    </form>
                    <button class="favorito-btn" th:data-producto-id="${producto.id}" style="background: #ff6b9d; border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 18px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease;">‚ù§Ô∏è</button>
                </div>
            </div>
        </div>

        <button class="carrusel-btn next">&#10095;</button>
    </div>
</div>
</th:block>

<div class="ofertas-container" style="background: var(--gradient-light); padding: 20px 25px; border-radius: 10px; overflow: hidden; max-width: 100%; box-sizing: border-box; display: flex; gap: 25px; justify-content: center; flex-wrap: nowrap;">
    <div class="bloque" style="margin-bottom: 40px; overflow: hidden; flex: 0 0 300px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <span class="vendido1" style="background: var(--gradient-secondary); color: white; padding: 6px 15px; border-radius: 15px; font-weight: bold; font-size: 1em; align-self: flex-start;">Oferta del dia</span>
        <div class="producto-card" style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 15px 15px 70px 15px; width: 240px; text-align: center; position: relative; margin-top: 12px; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center;" th:if="${productos != null and !productos.isEmpty()}">
            <img th:src="${productos[0].imagen != null and !#strings.isEmpty(productos[0].imagen) and #strings.startsWith(productos[0].imagen, 'http') 
                          ? productos[0].imagen 
                          : (productos[0].imagen != null and !#strings.isEmpty(productos[0].imagen) 
                              ? '/frontend/imagenes/' + productos[0].imagen 
                              : '/frontend/imagenes/placeholder.png')}"
                 th:alt="${productos[0].nombre}" style="width: 180px; height: auto; margin: 0 auto; display: block; border-radius: 10px;">
            <a th:href="@{'/producto/' + ${productos[0].id}}" style="display: inline-block; margin: 15px 0; background: var(--gradient-secondary); color: white; padding: 8px 15px; border-radius: 12px; font-weight: bold; font-size: 1em; text-decoration: none;">Ver M√°s Detalles</a>
            <h3 style="font-weight: bold; margin: 12px 0 8px; font-size: 1.2em;" th:text="${productos[0].nombre}">Producto</h3>
            <p style="margin: 8px 0; font-size: 1em;">4.9 ‚≠ê</p>
            <th:block th:if="${productos[0].precioOriginal != null and productos[0].precioDescuento != null}">
              <p class="precio-original" style="text-decoration: line-through; color: gray; margin: 8px 0; font-size: 0.9em;">
                $<span th:text="${productos[0].precioOriginal}">0</span>
              </p>
              <p class="precio-descuento" style="color: #006600; font-weight: bold; margin: 8px 0; font-size: 1.1em;">
                $<span th:text="${productos[0].precioDescuento}">0</span>
                <span class="descuento" style="background-color: #cce5cc; color: #006600; padding: 3px 8px; border-radius: 6px; font-size: 0.9em; margin-left: 8px;">-5%</span>
              </p>
            </th:block>
            <div style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; align-items: center;">
              <form th:action="@{'/carrito/agregar/' + ${productos[0].id}}" method="POST" style="display: inline;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="carrito-btn" style="background: var(--gradient-secondary); border: none; border-radius: 50%; width: 48px; height: 48px; color: white; font-size: 24px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
                  &#128722;
                </button>
              </form>
              <button class="favorito-btn" th:data-producto-id="${productos[0].id}" style="background: #ff6b9d; border: none; border-radius: 50%; width: 48px; height: 48px; color: white; font-size: 24px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease;">‚ù§Ô∏è</button>
            </div>
        </div>
    </div>
     <div class="bloque" style="margin-top: 40px; overflow: hidden; flex: 0 0 660px;">
        <div class="bloque-header" style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <span class="vendido1" style="background: var(--gradient-secondary); color: white; padding: 6px 15px; border-radius: 15px; font-weight: bold; font-size: 1em;">Ofertas que te pueden interesar</span>
            <a href="#" class="ver-mas" style="color: #00d4ff; font-weight: bold; font-size: 1em; text-decoration: none;">Ver mas</a>
        </div>
        <div class="productos-grid" style="display: flex; gap: 20px; overflow: hidden; flex-wrap: nowrap; justify-content: flex-start;">
            <div class="producto-card" style="background: white; border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.1); padding: 15px 15px 70px 15px; width: 200px; text-align: center; position: relative;" th:each="producto, iterStat : ${productos}" th:if="${iterStat.index < 3}">
                <img th:src="${producto.imagen != null and !#strings.isEmpty(producto.imagen) and #strings.startsWith(producto.imagen, 'http') 
                              ? producto.imagen 
                              : (producto.imagen != null and !#strings.isEmpty(producto.imagen) 
                                  ? '/frontend/imagenes/' + producto.imagen 
                                  : '/frontend/imagenes/placeholder.png')}"
                     th:alt="${producto.nombre}" style="width: 140px; height: auto; margin: 0 auto; display: block; border-radius: 10px;">
                <a th:href="@{'/producto/' + ${producto.id}}" style="display: inline-block; margin: 12px 0; background: var(--gradient-secondary); color: white; padding: 6px 12px; border-radius: 12px; font-weight: bold; font-size: 0.9em; text-decoration: none;">Ver M√°s Detalles</a>
                <h3 style="font-weight: bold; margin: 10px 0 6px; font-size: 1em;" th:text="${producto.nombre}">Producto</h3>
                <p style="margin: 6px 0; font-size: 0.9em;">4.9 ‚≠ê</p>
                <th:block th:if="${producto.precioOriginal != null and producto.precioDescuento != null}">
                  <p class="precio-original" style="text-decoration: line-through; color: gray; margin: 6px 0; font-size: 0.8em;">
                    $<span th:text="${producto.precioOriginal}">0</span>
                  </p>
                  <p class="precio-descuento" style="color: #006600; font-weight: bold; margin: 6px 0; font-size: 1em;">
                    $<span th:text="${producto.precioDescuento}">0</span>
                    <span class="descuento" style="background-color: #cce5cc; color: #006600; padding: 2px 6px; border-radius: 6px; font-size: 0.8em; margin-left: 6px;">-5%</span>
                  </p>
                </th:block>
                <div style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; align-items: center;">
                  <form th:action="@{'/carrito/agregar/' + ${producto.id}}" method="POST" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="carrito-btn" style="background: var(--gradient-secondary); border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 20px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
                      &#128722;
                    </button>
                  </form>
                  <button class="favorito-btn" th:data-producto-id="${producto.id}" style="background: #ff6b9d; border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 20px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease;">‚ù§Ô∏è</button>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="navegacion-categorias">
  <h2>Explora por Categor√≠a</h2>
  <div class="categorias-grid">
    <a th:each="categoria : ${categorias}" 
       th:href="@{'/categoria/' + ${#strings.toLowerCase(categoria)}}" 
       class="categoria-item" 
       th:text="${categoria}">Categor√≠a</a>
  </div>
</section>

<section class="marcas">
  <h2>Marcas Populares</h2>
  <div class="brand-list">
    <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" alt="Apple" />
    <img src="https://images.samsung.com/is/image/samsung/assets/global/about-us/brand/logo/360_197_1.png?$720_N_PNG$" alt="Samsung" />
    <img src="https://1000marcas.net/wp-content/uploads/2019/12/Xiaomi-Logo.png" alt="Xiaomi" />
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Motorola_logo.svg/1200px-Motorola_logo.svg.png" alt="Motorola" />
  </div>
</section>

<section class="navegacion-marcas">
  <h2>Busca por Marca</h2>
  <div class="marcas-grid">
    <a th:each="marca : ${marcas}" 
       th:href="@{'/marca/' + ${#strings.toLowerCase(marca)}}" 
       class="marca-item" 
       th:text="${marca}">Marca</a>
  </div>
</section>

<footer>
    <p>¬© 2025 TECHNOVA. Todos los derechos reservados.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:src="@{/frontend/js/script.js}" defer></script>
<script th:src="@{/frontend/js/carrusel.js}" defer></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  const usuarioId = /*[[${usuario != null ? usuario.id : null}]]*/ null;
  const csrfToken = /*[[${_csrf != null ? _csrf.token : ''}]]*/ '';
  const csrfHeaderName = /*[[${_csrf != null ? _csrf.headerName : ''}]]*/ '';
  /*]]>*/
</script>
<script th:src="@{/frontend/js/agregar-carrito.js}" defer></script>
<script th:src="@{/frontend/js/carrito-dropdown.js}" defer></script>
<script th:src="@{/frontend/js/favoritos.js}" defer></script>
<script th:src="@{/frontend/js/busqueda-filtros.js}" defer></script>
</body>
</html>




