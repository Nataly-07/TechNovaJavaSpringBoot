<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mis Favoritos - Technova</title>
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" th:href="@{/frontend/css/stilotech.css}">
    <link rel="stylesheet" th:href="@{/frontend/css/color-palette.css}">
    <style>
        .favoritos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
        }
        
        .favorito-card {
            background: var(--janna-light);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease;
            border: 2px solid var(--sinbad);
        }
        
        .favorito-card:hover {
            transform: translateY(-5px);
        }
        
        .favorito-card img {
            width: 100%;
            height: 180px;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            padding: 10px;
        }
        
        .favorito-card h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1em;
        }
        
        .favorito-card .precio {
            color: #00d4ff;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .favorito-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .btn-favorito {
            background-color: var(--danger);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 16px;
            cursor: pointer;
            color: white;
        }
        
        .btn-carrito {
            background: var(--gradient-primary);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 16px;
            cursor: pointer;
            color: white;
        }
        
        .empty-favoritos {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-favoritos h2 {
            color: #999;
            margin-bottom: 20px;
        }
        
        .empty-favoritos a {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
        }
    </style>
</head>
<body>
  <header class="header">
    <a th:href="@{/}" class="logo">
      <img th:src="@{/frontend/imagenes/logo technova.png}" alt="Logo">
      <span>TECHNOVA</span>
    </a>

    <div class="acciones-usuario" th:if="${usuario == null}">
      <a th:href="@{/login}" class="account"><i class='bx bx-user-circle'></i> <span>Iniciar Sesión</span></a>
      <a th:href="@{/registro}" class="account"><i class='bx bx-user-plus'></i> <span>Crear Cuenta</span></a>
    </div>
    <div class="acciones-usuario" th:if="${usuario != null}">
      <a th:href="@{/cliente/perfil}" class="account"><i class='bx bx-user-circle'></i> <span>Perfil</span></a>
      <a th:href="@{/favoritos}" class="account"><i class='bx bx-heart'></i> <span>Favoritos</span></a>
      <a th:href="@{/carrito}" class="account"><i class='bx bx-cart'></i> <span>Carrito</span></a>
      <form method="POST" th:action="@{/logout}" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;display:inline-flex;align-items:center;gap:5px;" class="account">
          <i class='bx bx-log-out'></i> <span>Cerrar Sesión</span>
        </button>
      </form>
    </div>
  </header>

  <div class="dashboard-wrapper" th:if="${usuario != null}">
    <div th:replace="~{frontend/layouts/sidebar-cliente :: sidebar}"></div>
    <main class="main-content">
    <div class="welcome-section" style="text-align: center; padding: 30px;">
      <h1>❤️ Mis Favoritos</h1>
      <p>Productos que has marcado como favoritos</p>
    </div>

    <div th:if="${productos != null && !productos.isEmpty()}" class="favoritos-grid">
      <div class="favorito-card" th:each="producto : ${productos}">
        <img th:src="${producto.imagen != null && !producto.imagen.isEmpty() ? (producto.imagen.startsWith('http') ? producto.imagen : '/frontend/imagenes/' + producto.imagen) : '/frontend/imagenes/foto perfil.webp'}"
             th:alt="${producto.nombre}">
        <h3 th:text="${producto.nombre}">Producto</h3>
        <div class="precio" th:if="${producto.caracteristica != null && producto.caracteristica.precioVenta != null}">
          $<span th:text="${producto.caracteristica.precioVenta}">0</span>
        </div>
        
        <div class="favorito-actions">
          <button class="btn-favorito favorito-btn" th:attr="data-producto-id=${producto.id}">❤️</button>
          <button class="btn-carrito carrito-btn" th:attr="data-producto-id=${producto.id}">&#128722;</button>
        </div>
      </div>
    </div>

    <div th:if="${productos == null || productos.isEmpty()}" class="empty-favoritos">
      <h2>No tienes productos favoritos aún</h2>
      <p>Explora nuestro catálogo y marca tus productos favoritos con el corazón ❤️</p>
      <a th:href="@{/}">Ver Catálogo</a>
    </div>
    </main>
  </div>

  <main class="main-content" th:if="${usuario == null}">
    <div class="empty-favoritos">
      <h2>Debes iniciar sesión para ver tus favoritos</h2>
      <p>Inicia sesión o crea una cuenta para guardar tus productos favoritos</p>
      <a th:href="@{/login}">Iniciar Sesión</a>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Technova</p>
  </footer>

  <script th:inline="javascript">
    /*<![CDATA[*/
    const usuarioId = /*[[${usuario != null ? usuario.id : null}]]*/ null;
    
    document.addEventListener("DOMContentLoaded", () => {
        const favoritoBtns = document.querySelectorAll('.favorito-btn');
        
        favoritoBtns.forEach(btn => {
            btn.addEventListener('click', async function() {
                if (!usuarioId) {
                    window.location.href = '/login';
                    return;
                }
                const productoId = btn.getAttribute('data-producto-id');
                // TODO: Implementar eliminación de favorito
                alert('Funcionalidad de eliminar favorito pendiente');
            });
        });

        const carritoBtns = document.querySelectorAll('.carrito-btn');
        carritoBtns.forEach(btn => {
            btn.addEventListener('click', async function(e) {
                e.preventDefault();
                if (!usuarioId) {
                    window.location.href = '/login';
                    return;
                }
                const productoId = btn.getAttribute('data-producto-id');
                if (productoId) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/carrito/agregar/' + productoId;
                    
                    const csrfToken = document.querySelector('input[name="_csrf"]');
                    if (csrfToken) {
                        const csrfInput = document.createElement('input');
                        csrfInput.type = 'hidden';
                        csrfInput.name = csrfToken.name;
                        csrfInput.value = csrfToken.value;
                        form.appendChild(csrfInput);
                    }
                    
                    document.body.appendChild(form);
                    form.submit();
                }
            });
        });
    });
    /*]]>*/
  </script>
</body>
</html>

